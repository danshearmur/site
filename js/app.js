(function () {

  Modernizr.load({
    test: Modernizr.mq('only screen and (min-width: 768px)') && window.location.pathname == "/",
    yep: '/js/desktop.js'
  })

  var body, header, svgs;

  function getFirst(el) {
    return document.getElementsByTagName(el)[0];
  }

  body   = getFirst('body');
  header = getFirst('header');

  svgs = [];

  // Set the class on the body, and update every 2.5 minutes
  (function () {

    var load_time, interval, time_class, transition_class;

    load_time        = new Date();
    interval         = Math.floor(load_time.getMinutes() / 2.5);
    time_class       = "t" + interval;
    transition_class = ' trans';

    body.className = time_class;
    if (body.className.indexOf(transition_class) != -1) {
      body.className += transition_class;
    } else {
      setTimeout(function () {
        body.className += transition_class;
      }, 1);
    }

    updateColours();

    setTimeout(arguments.callee, 2.5 * 60 * 1000);

  }) ();

  function getColour() {
    if (header.currentStyle) {
      return header.currentStyle['borderRightColor'];
    }
    return document.defaultView.getComputedStyle(header, null).getPropertyValue('border-right-color');
  }

  function Svg(pathStr, id, dark) {
    var attrs, colour, paper, path;
    colour = dark ? '#140C1A': getColour();
    attrs = {
      stroke: 'none',
      fill: colour,
      cursor: 'pointer'
    };
    paper = Raphael(id, 36, 36);
    paper.path(pathStr).attr(attrs);
    if (!dark) {
      svgs.push(paper);
    }
    return paper;
  }

  function updateColours () {
    for (var i = 0, svg, colour; svg = svgs[i]; i++) {
      colour = getColour();
      svg.forEach(function (el) {
        el.animate({
          fill: colour
        }, 5000);
      });
    }
  };

  Svg('M5,0C2.23,0,0,2.23,0,5L0,31C0,33.77,2.23,36,5,36L31,36C33.77,36,36,33.77,36,31L36,5C36,2.23,33.77,0,31,0L5,0zM12.15625,8L14.9375,8L14.9375,24L12.5625,24L12.375,22.6875C12.0937,23.125,11.75,23.4687,11.375,23.6875C11,23.9062,10.5469,24,10.0625,24C8.9375,24,8.09375,23.5313,7.46875,22.5625C6.84375,21.6094,6.5625,20.3282,6.5625,18.75L6.5625,18.5625C6.5625,16.9062,6.84375,15.56245,7.46875,14.53125C8.09375,13.51555,8.9844,13,10.125,13C10.5312,13,10.9063,13.1094,11.25,13.3125C11.5938,13.5313,11.89055,13.8125,12.15625,14.1875L12.15625,8zM17.0625,8L19.8125,8L19.8125,10.1875L17.0625,10.1875L17.0625,8zM17.125,13L19.875,13L19.875,24.0625C19.875,25.3125,19.56245,26.28125,18.96875,26.96875C18.37495,27.65625,17.5313,28,16.5,28C16.2657,28,16.0625,27.9688,15.875,27.9375C15.7031,27.9063,15.4844,27.8594,15.25,27.8125L15.375,25.65625C15.5313,25.68745,15.6407,25.7188,15.75,25.75C15.8907,25.7656,16.0312,25.78125,16.1875,25.78125C16.4687,25.78125,16.7031,25.62495,16.875,25.34375C17.0312,25.03125,17.125,24.59375,17.125,24.03125L17.125,13zM25.375,13C26.5469,13,27.49995,13.375,28.21875,14.0625C28.92185,14.75,29.2812,15.60935,29.25,16.65625L29.21875,16.6875L26.5625,16.6875C26.5625,16.25,26.4375,15.9063,26.25,15.625C26.0469,15.3438,25.7656,15.1875,25.375,15.1875C25.0469,15.1875,24.7813,15.2969,24.5625,15.5C24.3438,15.7032,24.25,15.9688,24.25,16.25C24.25,16.5625,24.3438,16.8125,24.5625,17C24.7813,17.1875,25.24995,17.4375,25.96875,17.75C27.07805,18.125,27.8907,18.5625,28.4375,19.0625C28.9688,19.5625,29.25,20.21875,29.25,21.03125C29.25,21.90625,28.9063,22.625,28.1875,23.1875C27.4688,23.75,26.51555,24,25.34375,24C24.10935,24,23.1562,23.6562,22.4375,22.9375C21.7187,22.2187,21.37495,21.4062,21.40625,20.5L21.4375,20.4375L23.9375,20.4375C23.9375,21.0313,24.07805,21.4375,24.34375,21.6875C24.59375,21.9375,24.9687,22.0625,25.4375,22.0625C25.8125,22.0625,26.1094,22,26.3125,21.8125C26.5156,21.625,26.625,21.3282,26.625,21C26.625,20.6875,26.4844,20.43745,26.25,20.21875C26,19.99995,25.5625,19.71875,24.875,19.40625C23.7969,18.99995,22.9688,18.5625,22.4375,18.0625C21.8906,17.5625,21.625,16.9219,21.625,16.125C21.625,15.2656,21.96875,14.51555,22.65625,13.90625C23.34375,13.31245,24.2344,13,25.375,13zM10.8125,15.1875C10.2656,15.1875,9.8594,15.5156,9.625,16.125C9.375,16.75,9.28125,17.5625,9.28125,18.5625L9.28125,18.75C9.28125,19.7031,9.3906,20.4687,9.625,21C9.8594,21.5469,10.2656,21.8125,10.8125,21.8125C11.1094,21.8125,11.35935,21.73435,11.59375,21.59375C11.81245,21.46875,11.99995,21.2812,12.15625,21L12.15625,16.1875C11.99995,15.8906,11.7969,15.64055,11.5625,15.46875C11.3282,15.29685,11.0938,15.1875,10.8125,15.1875z',
      'djs',
      true);

  Svg('M5,0C2.23,0,0,2.23,0,5L0,31C0,33.77,2.23,36,5,36L31,36C33.77,36,36,33.77,36,31L36,5C36,2.23,33.77,0,31,0L5,0zM17.96875,7C24.07755,7,29,11.924,29,18C29,24.0786,24.07755,29,17.96875,29C11.90245,29,7,24.0786,7,18C7,11.924,11.90245,7,17.96875,7zM17.96875,8.71875C12.84865,8.71875,8.71625,12.8702,8.71875,18C8.71875,18.4565,8.7487,18.90635,8.8125,19.34375C10.169,19.13405,11.0928,19.2194,12.0625,19.25C11.8289,18.6014,11.72345,17.86435,11.71875,17.03125C11.71625,15.92715,12.1037,15.0205,12.75,14.3125C12.6462,14.0567,12.29395,13.04965,12.84375,11.65625C12.84375,11.65625,13.6926,11.3779,15.625,12.6875C16.432,12.4622,17.3283,12.34745,18.1875,12.34375C18.9658,12.34265,19.73735,12.41315,20.46875,12.59375C22.33285,11.33595,23.15625,11.59375,23.15625,11.59375C23.62825,12.76545,23.46885,13.68075,23.34375,14.09375C24.07505,14.81945,24.52875,15.8013,24.53125,17C24.53555,17.8356,24.45835,18.56645,24.28125,19.21875C25.22515,19.17655,25.92345,19.03855,27.21875,19.21875C27.27095,18.82235,27.28125,18.4106,27.28125,18C27.28125,12.8702,23.12905,8.71875,17.96875,8.71875zM25.59375,19.21875C25.142187,19.239975,24.7518,19.29065,24.28125,19.3125C24.24335,19.4445,24.1746,19.564,24.125,19.6875C25.0617,19.7116,25.73265,19.6248,27.09375,19.9375C27.13865,19.7252,27.1566,19.49845,27.1875,19.28125C26.534,19.1911,26.045313,19.197525,25.59375,19.21875zM10.59375,19.28125C10.069325,19.277863,9.4991,19.3006,8.8125,19.40625C8.8479,19.62465,8.8901,19.8488,8.9375,20.0625C10.3436,19.7361,11.3038,19.7839,12.25,19.75C12.1864,19.6237,12.14575,19.47855,12.09375,19.34375C11.61015,19.32725,11.118175,19.284637,10.59375,19.28125zM24.09375,19.78125C23.56075,21.00625,22.39935,21.78085,19.96875,22.03125C20.38625,22.31445,20.8101,22.8593,20.8125,23.875L20.84375,26.46875C20.84375,26.46875,20.85915,26.62075,21.03125,26.78125C24.06535,25.73575,26.3663,23.1703,27.0625,20C25.6868,19.6851,25.02565,19.80365,24.09375,19.78125zM12.3125,19.8125C11.3735,19.8458,10.39155,19.82485,8.96875,20.15625C9.74755,23.45965,12.28215,26.07665,15.53125,26.96875C15.67505,26.73485,15.6875,26.5,15.6875,26.5L15.6875,24.6875C13.1581,25.2621,12.625,23.5,12.625,23.5C12.2193,22.4674,11.625,22.1875,11.625,22.1875C10.8132,21.6332,11.6875,21.625,11.6875,21.625C12.584,21.6888,13.0625,22.5625,13.0625,22.5625C13.9048,24.004,15.3112,23.465,15.75,23.25C15.8822,22.6245,16.20565,22.25195,16.53125,22.03125C14.24735,21.79425,12.9684,21.0267,12.3125,19.8125zM11.90625,21.71875C11.80965,21.71875,11.71875,21.77625,11.71875,21.84375C11.71875,21.91085,11.80965,21.96875,11.90625,21.96875C12.00315,21.96765,12.0625,21.90975,12.0625,21.84375C12.0625,21.77645,12.00075,21.71785,11.90625,21.71875zM12.375,22C12.2808,22,12.21875,22.0576,12.21875,22.125C12.22145,22.1911,12.2781,22.2513,12.375,22.25C12.4693,22.25,12.565,22.1924,12.5625,22.125C12.5625,22.0587,12.4718,21.999,12.375,22zM12.6875,22.34375C' +
      '12.5906,22.34375,12.5,22.40125,12.5,22.46875C12.5,22.53585,12.5906,22.59375,12.6875,22.59375C12.7818,22.59245,12.84375,22.53605,12.84375,22.46875C12.84375,22.40145,12.7819,22.34375,12.6875,22.34375zM12.9375,22.75C12.8409,22.75,12.78135,22.8079,12.78125,22.875C12.78125,22.9413,12.87215,23,12.96875,23C13.06305,22.9987,13.125,22.9425,13.125,22.875C13.125,22.809,13.0317,22.75,12.9375,22.75zM13.25,23.125C13.1534,23.1265,13.0625,23.1851,13.0625,23.25C13.0625,23.317,13.1534,23.375,13.25,23.375C13.3469,23.3736,13.4375,23.3181,13.4375,23.25C13.4375,23.1839,13.3446,23.125,13.25,23.125zM18.125,23.375L18.09375,26.6875C18.08435,26.9424,18.04665,27.12195,17.96875,27.28125C18.16005,27.28125,18.3734,27.29195,18.5625,27.28125C18.4918,27.12695,18.41845,26.90485,18.40625,26.65625L18.375,23.375L18.125,23.375zM13.65625,23.4375C13.55955,23.4375,13.46875,23.4977,13.46875,23.5625C13.46875,23.6313,13.56185,23.6875,13.65625,23.6875C13.75315,23.6875,13.8125,23.63,13.8125,23.5625C13.8125,23.4965,13.75315,23.4362,13.65625,23.4375zM17.03125,23.46875C16.64445,23.74455,16.6875,24.53125,16.6875,24.53125L16.71875,26.53125C16.72105,26.82965,16.625,27.00765,16.5,27.15625C16.6203,27.17535,16.7522,27.20315,16.875,27.21875C17.0141,26.96985,17.03125,26.71915,17.03125,26.71875L17.03125,23.46875zM19.46875,23.5L19.5,26.71875C19.5,26.71875,19.5011,26.92375,19.5625,27.15625C19.6947,27.13365,19.83665,27.0924,19.96875,27.0625C19.87925,26.9236,19.8125,26.7462,19.8125,26.5L19.8125,24.53125C19.8125,24.53125,19.85565,23.7997,19.46875,23.5zM15.34375,23.5625C15.24925,23.5625,15.15625,23.6214,15.15625,23.6875C15.15625,23.755,15.24685,23.8125,15.34375,23.8125C15.43805,23.8112,15.53125,23.7556,15.53125,23.6875C15.53125,23.6223,15.44035,23.5615,15.34375,23.5625zM14.21875,23.65625C14.12215,23.65625,14.03125,23.71315,14.03125,23.78125C14.03375,23.84645,14.11955,23.90625,14.21875,23.90625C14.31535,23.90525,14.375,23.84605,14.375,23.78125C14.375,23.71415,14.31555,23.65625,14.21875,23.65625zM14.78125,23.65625C14.68445,23.65625,14.59375,23.71395,14.59375,23.78125C14.59375,23.84705,14.68445,23.90625,14.78125,23.90625C14.87775,23.90625,14.9396,23.84605,14.9375,23.78125C14.9375,23.71245,14.87535,23.65625,14.78125,23.65625z',
      'github');

  Svg('M4.5,0C1.73,0,-0.5,2.23,-0.5,5L-0.5,31C-0.5,33.77,1.73,36,4.5,36L30.5,36C33.27,36,35.5,33.77,35.5,31L35.5,5C35.5,2.23,33.27,0,30.5,0L4.5,0zM22.46875,11C22.408477,11.342186,22.002877,11.590646,21.59375,11.75C22.237855,11.535264,23.4236,11.12413,23.59375,11.46875C23.83435,11.93885,22.29155,12.13725,22.03125,12.21875C21.83575,12.27515,21.65965,12.33875,21.46875,12.40625C23.84055,12.19985,26.0905,13.91515,26.75,16.03125C26.7985,16.18435,26.86235,16.35305,26.90625,16.53125C27.77265,16.81205,29.33815,16.5218,29.84375,16.25C29.47805,17.005,28.5295,17.55565,27.125,17.65625C27.8006,17.90085,29.08835,18.03615,29.96875,17.90625C29.41105,18.42585,28.49835,18.8861,26.96875,18.875C24.93125,26.0711,11.26375,29.12705,4.96875,21.65625C7.38105,23.65955,11.55655,23.8335,14.21875,21.4375C12.65685,21.6369,11.5193,20.31455,13.4375,19.59375C11.7137,19.75785,10.7684,18.96075,10.375,18.28125C10.7799,17.91375,11.23185,17.7369,12.09375,17.6875C10.20565,17.2989,9.49415,16.50785,9.28125,15.53125C9.80545,15.42255,10.4549,15.3327,10.8125,15.375C9.1592,14.6229,8.5973,13.4767,8.6875,12.625C11.6437,13.5805,13.51905,14.35875,15.09375,15.09375C15.65375,15.35445,16.2942,15.80935,17,16.40625C17.8978,14.33545,19.00425,12.21435,20.90625,11.15625C20.87515,11.39585,20.72675,11.59905,20.53125,11.78125C21.07165,11.35445,21.75615,11.0856,22.46875,11z',
      'twitter');

  Svg('M8,18L18,18L18,8L25.2222,8C26.7564,8,28,9.2436,28,10.7778L28,18L18.5556,18L18.5556,28L10.7778,28C9.2436,28,8,26.7564,8,25.2222L8,18zM5,0C2.2385,0,0,2.2385,0,5L0,31C0,33.7615,2.2385,36,5,36L31,36C33.7615,36,36,33.7615,36,31L36,5C36,2.2385,33.7615,0,31,0L5,0z',
      'delicious');

})();
